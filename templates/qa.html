<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Q and A Bot</title>
    
    <!-- Link to External CSS (use relative path instead of absolute) -->
    <link rel="stylesheet" href="static/css/qa.css"> <!-- Adjust according to your structure -->

    <!-- Bootstrap CSS for quick layout styling -->
    <link 
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" 
        rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" 
        crossorigin="anonymous"
    >
</head>
<body class="bg-dark text-light">

    <div class="container mt-5">
        <div class="chat-container bg-secondary rounded p-4 shadow-lg">
            <!-- Header with Bot Title and New Chat Button -->
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2 class="mb-0">Bart Q and A Bot</h2>
                <button class="btn btn-outline-light" onclick="startNewChat()">New Chat</button>
            </div>

            <!-- Chat Box for Message Display -->
            <div class="chat-box bg-dark rounded p-3 mb-3" id="chat-box" style="height: 400px; overflow-y: auto;">
                <!-- Messages will be dynamically inserted here -->
            </div>

            <!-- Input Section -->
            <div class="input-box d-flex align-items-center">
                <!-- PDF Upload Form -->
                <form id="upload-form" action="/chat/{{ session_id }}" method="post" enctype="multipart/form-data" class="me-2">
                    <input 
                        type="file" 
                        name="upload_doc" 
                        id="upload-doc" 
                        accept=".pdf" 
                        onchange="uploadPDF()" 
                        hidden
                    >
                    <label for="upload-doc" class="btn btn-outline-light">ðŸ“Ž</label>
                </form>

                <!-- Text Input for User Message -->
                <input 
                    type="text" 
                    id="user-input" 
                    class="form-control me-2" 
                    placeholder="Type a message" 
                    onkeypress="handleKeyPress(event)"
                >

                <!-- Send Button with Icon -->
                <button class="btn btn-primary" onclick="sendMessage()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                        <path d="M4 12l1.41 1.41L10 8.83V20h2V8.83l4.59 4.58L20 12 12 4 4 12z" fill="#ffffff"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS for additional interactivity -->
    <script 
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" 
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" 
        crossorigin="anonymous"
    ></script>

    <!-- Link to External JS -->
    <script src="static/script/qa.js"></script> <!-- Adjust according to your structure -->
    
    <script>
        // Ensure you define these functions in your qa.js
        function startNewChat() {
            // Logic to start a new chat, e.g., clearing chat history
            document.getElementById('chat-box').innerHTML = '';
        }

        function uploadPDF() {
            const formData = new FormData(document.getElementById('upload-form'));
            fetch('/chat/{{ session_id }}', {
                method: 'POST',
                body: formData
            }).then(response => {
                return response.json();
            }).then(data => {
                // Handle the response from the server
                if (data.response) {
                    appendMessage(data.response, 'bot');
                }
            }).catch(error => {
                console.error('Error:', error);
            });
        }

        function sendMessage() {
            const userMessage = document.getElementById('user-input').value;
            appendMessage(userMessage, 'user');

            fetch(`/chat/{{ session_id }}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams({ message: userMessage })
            }).then(response => {
                return response.json();
            }).then(data => {
                if (data.response) {
                    appendMessage(data.response, 'bot');
                }
            }).catch(error => {
                console.error('Error:', error);
            });

            document.getElementById('user-input').value = ''; // Clear input after sending
        }

        function appendMessage(message, sender) {
            const chatBox = document.getElementById('chat-box');
            const messageDiv = document.createElement('div');
            messageDiv.className = sender === 'user' ? 'text-end' : 'text-start';
            messageDiv.textContent = message;
            chatBox.appendChild(messageDiv);
            chatBox.scrollTop = chatBox.scrollHeight; // Auto-scroll to the bottom
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }
    </script>
</body>
</html>
